# Lumi 功能介绍

Lumi（ZeroAssistent）是一款在本地运行的 **USB 物联网 + 电脑助手** Agent，配合 Qwen / DeepSeek / 阿里云 DashScope 等大模型，可完成硬件代码生成烧录、文档润色、代码编辑、终端命令、做网页/小游戏、PPT/Word 生成等任务。本文档按模块介绍主要功能，会随项目迭代更新。

---

## 一、硬件烧录（核心）

让 Lumi 为你的 USB 设备写代码并烧录到板子。

| 功能 | 说明 |
|------|------|
| **自然语言生成代码** | 用一句话描述需求，自动生成 MicroPython 或 C++（PlatformIO）代码。例如：「让接在 GPIO5 的舵机从 0° 转到 90°，停 2 秒再回到 0°，循环执行」。 |
| **自动识别串口** | 连接 USB 设备后，自动列出串口并尝试识别 ESP8266 等开发板，无需手动查端口。 |
| **一键烧录** | 生成代码后，在界面选择「烧录到设备」，通过 mpremote 将代码上传为设备上的 `main.py`，复位后即可运行。 |
| **多开发板支持** | MicroPython 模式适用于 ESP8266 等；C++ / PlatformIO 模式可选 ESP8266、ESP32、树莓派 Pico (RP2040)、STM32、Arduino Uno 等开发板。 |
| **多文件项目** | 支持生成多文件项目并一次性烧录到设备。 |
| **从 GitHub 拉取** | 支持根据指令从 GitHub 拉取项目并部署到设备。 |

**使用步骤**：连接设备 → 左侧选择串口（或使用自动猜测）→ 在输入框用自然语言描述需求 → 发送 → 确认后点击「烧录到设备」。

---

## 二、电脑助手（PC 助手）

用自然语言在电脑上完成文档、代码、终端、做网站等任务。Lumi 会根据你的表述自动选择模式（也可手动指定）。

### 2.1 自动识别的能力

| 模式 | 触发示例 | 说明 |
|------|----------|------|
| **做网站/小游戏**（create_file） | 「帮我做一个抢红包的网页小游戏」「在桌面做一个待办网站」 | 自动生成 HTML/JS 等并保存到桌面指定文件夹，可自动打开。 |
| **查看文件夹**（list_folder） | 「看看桌面里有什么」「列出这个目录下的文件」 | 列出指定目录内容，便于后续操作。 |
| **终端命令**（terminal） | 「运行当前目录的 test.py」「用 pip 安装 requests」 | 生成并可选执行终端命令（白名单限制，避免危险命令）。 |
| **待办列表**（todo） | 「列一下待办」「记一下要做的事」 | 生成或维护 TODO 列表。 |
| **计划/步骤**（plan） | 「分几步实现」「怎么做这个功能」 | 生成分步计划或实现步骤。 |
| **批量编辑**（folder_edit） | 「把这个文件夹下所有 .py 里的 xxx 改成 yyy」 | 对目录内多文件做批量修改。 |
| **修改代码**（edit_code） | 「修改桌面的 main.py，加一个延时」「改一下这个 .js 的 bug」 | 读取指定代码文件，按你的要求修改并写回。 |
| **文本润色**（polish） | 「润色桌面上的宣传片文案.docx」 | 读取 .docx/.txt 等，润色后写回。 |
| **深度思考**（deep_think） | 「分析一下为什么报错」「解释一下这段逻辑」 | 通用推理、分析、解释。 |

### 2.2 终端命令执行

- 回复中若包含可执行命令，会显示 **「执行命令」** 按钮，点击后在本地执行（受白名单限制）。
- 支持：列出/查看文件、运行 Python、pip 安装、压缩解压、curl/wget 下载等；危险命令（如 `rm -rf /`）不会执行。

### 2.3 做 PPT / Word

- **PPT**：说「帮我做一个关于 xxx 的 PPT」等，Lumi 可生成真实 `.pptx` 文件（需安装 `python-pptx`），按空行分页、支持插入图片等。
- **Word**：对 `.docx` 进行润色或改写后写回；也可将内容导出为 Word 文档。

### 2.4 创建项目到桌面

- 说「做一个小游戏」「在桌面创建 xxx 网站」时，会在桌面（或指定位置）创建文件夹，并生成 `index.html` 等文件，完成后可一键在文件管理器中打开。

### 2.5 复杂项目：文件夹与终端交给 AI

- **多文件与目录**：做网站/软件时，AI 用 `---FILE: 相对路径---` 输出多个文件（如 `src/main.py`、`requirements.txt`）；系统会**自动创建所需文件夹**（如 `src/`），无需你手动建目录。
- **多条终端命令**：AI 可在输出完所有 `---FILE:---` 后，连续输出多条 `---RUN: 命令 ---`（如 `pip install -r requirements.txt`、`npm install`、`pio run`、`mkdir -p build`）。系统会**按顺序在刚创建的项目目录下执行**，便于一键完成依赖安装、编译、构建。
- **工作目录**：上述 `---RUN:---` 的当前工作目录为**本次创建的项目文件夹**（桌面或项目根下的目标目录），因此「安装依赖」「编译」等命令会作用在正确路径。
- **终端白名单**：已扩展为支持 `mkdir`、`cp`、`mv`、`pio`、`npm`、`pip`、`make`、`cmake`、`cargo` 等常见开发命令；仍禁止 `rm -rf /` 等危险操作。允许执行的工作目录限定在**项目根与桌面及其子目录**内。

---

## 三、AI 编辑（代码补全 / 优化）

在「AI编辑」视图中，可对当前打开的文件做：

| 功能 | 说明 |
|------|------|
| **代码补全** | 根据上下文补全或继续写代码。 |
| **代码优化** | 对选中或当前文件进行优化、重构建议。 |
| **文件/代码模式** | 支持按文件路径编辑，或直接粘贴代码片段进行操作。 |

适合在写代码时快速补全、优化或按自然语言修改某一段逻辑。

---

## 四、小工具箱

右侧「小工具箱」提供按分类整理的自动化脚本，点击「运行」即可执行（部分需填写参数）。结果输出在「模型进程」日志区域。

### 维护

| 脚本 | 说明 |
|------|------|
| 清理 Lumi 缓存 | 删除临时工程、缓存文件，释放磁盘空间。 |

### 设备

| 脚本 | 说明 |
|------|------|
| 刷新串口列表 | 重新扫描 USB 串口设备。 |
| 检测 MicroPython | 检测指定串口是否为 MicroPython 设备。 |
| 列出设备上的文件 | 列出 MicroPython 设备根目录下的文件（需 mpremote）。 |
| 软复位 MicroPython 设备 | 向设备发送软复位。 |
| 设备安装 Python 包 (mip) | 在设备上通过 mip 安装包，如 umqtt.simple、aioble。 |
| 读取设备 REPL 输出 | 连接设备并采集一段时间内的输出，用于调试。 |

### 环境

| 脚本 | 说明 |
|------|------|
| 检查 PlatformIO | 检查 pio 是否安装及版本。 |
| 显示项目根目录 | 查看当前 Lumi 使用的项目根路径。 |
| 在文件管理器中打开项目根 | 用系统文件管理器打开项目根目录。 |
| 检测模型服务 | 检测您的本地 API 是否可用及延迟。 |
| 检查 Python 环境 | 查看本机 Python 版本。 |
| 检测并安装依赖 | 检测 README 中列出的依赖是否已安装，未安装则自动 pip 安装（需联网）。 |

### 代码

| 脚本 | 说明 |
|------|------|
| 导出代码到桌面 | 将当前代码保存为桌面文件（.py / .cpp 等）。 |
| 在项目中搜索文本 | 在项目根目录下按关键字搜索文件内容。 |
| 在项目根运行 Python 脚本 | 在项目根目录下执行指定脚本。 |
| 检查项目代码 (ruff) | 使用 ruff 对项目根目录进行静态检查（需安装 ruff）。 |
| Python 爬虫 / 下载 | 输入网址和下载路径，爬取并保存网页、图片、文件等到本地。 |

### 文档

| 脚本 | 说明 |
|------|------|
| PDF 转 Word | 将 PDF 转为 .docx，输出到指定路径或与 PDF 同目录（需 pdf2docx）。 |

---

## 五、设置与开发

在「设置开发」视图中可进行：

- **环境检测**：检测串口、MicroPython、PlatformIO、Python、模型服务等是否就绪。
- **模型信息**：查看当前使用的模型接口（本地 API / DeepSeek / DashScope）及模型名。
- **开发者介绍**：项目与团队信息。

便于排查环境问题、确认模型配置是否正确。

---

## 六、模型接口（三选一）

Lumi 需要至少配置一种模型接口才能使用助手、生成代码等功能：

| 方式 | 环境变量 | 说明 |
|------|----------|------|
| **本地/自建 API** | `QWEN_API_BASE`、`QWEN_API_KEY` | OpenAI 兼容的 chat/completions 接口（如本地 Qwen）。 |
| **DeepSeek** | `DEEPSEEK_API_KEY` | 使用 DeepSeek 官方或自建兼容 API。 |
| **阿里云 DashScope** | `DASHSCOPE_API_KEY` | 使用阿里云 DashScope。 |

配置多个时，程序会按策略选择第一个可用的接口；可通过 `PREFER_DEEPSEEK=1` 等优先使用某一方。详见 **README.md** 与 **密钥与密钥对说明.md**。

---

## 七、小结

- **硬件烧录**：自然语言 → MicroPython/C++ 代码 → 一键烧录到 USB 设备。  
- **电脑助手**：润色、改代码、终端、做网页/小游戏、TODO、Plan、深度思考、批量编辑、PPT/Word。  
- **AI 编辑**：代码补全、代码优化。  
- **小工具箱**：维护、设备、环境、代码、文档等一键脚本。  
- **设置开发**：环境与模型检测，便于部署与排错。  

### 相关文档

| 文档 | 说明 |
|------|------|
| [README.md](README.md) | 项目介绍、环境准备、运行方式、依赖与环境变量 |
| [密钥与密钥对说明.md](密钥与密钥对说明.md) | SSH / API / 开发者认证密钥的创建与使用 |
| [本地电脑搭建网站.md](本地电脑搭建网站.md) | 本机或局域网搭建 Lumi 网站 |
| [DEPLOY.md](DEPLOY.md) | 打包发布、Gunicorn、Docker、Nginx、HTTPS |
| [阿里云发布步骤.md](阿里云发布步骤.md) | 阿里云 ECS 部署步骤 |
| [公网发布具体步骤.md](公网发布具体步骤.md) | 公网域名与 HTTPS 发布 |
